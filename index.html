<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKX EARN BOT</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 24px;
            animation: fadeIn 1s ease-in-out;
        }
        main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        section {
            display: none;
        }
        section.active {
            display: block;
            animation: slideIn 0.5s ease;
        }
        .profile {
            text-align: center;
            margin-bottom: 20px;
        }
        .profile img {
            border-radius: 50%;
            width: 100px;
            height: 100px;
            animation: rotateIn 1s ease;
        }
        .balance {
            font-size: 28px;
            color: #4CAF50;
            text-align: center;
            margin: 20px 0;
            animation: bounceIn 1s;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 15px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        form {
            display: flex;
            flex-direction: column;
        }
        input, select {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .error {
            color: red;
            text-align: center;
        }
        nav {
            display: flex;
            justify-content: space-around;
            background-color: #fff;
            border-top: 1px solid #ccc;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        nav button {
            background: none;
            color: #4CAF50;
            font-size: 16px;
            padding: 10px;
            flex: 1;
            text-align: center;
        }
        nav button.active {
            background-color: #4CAF50;
            color: white;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        @keyframes rotateIn {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes bounceIn {
            0% { transform: scale(0.5); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <header>AKX Earn MiniApp</header>
    <main>
        <section id="home" class="active">
            <div class="profile">
                <img id="profile-pic" src="" alt="profile picture">
                <h2 id="username">loading...</h2>
            </div>
            <div class="balance">your balance: $<span id="balance">0.00</span></div>
        </section>
        <section id="task">
            <h2>TASK</h2>
            <p>you can watch 50 ads daily and earn 0.005$ for each</p>
            <p>remaining task: <span id="remaining-tasks">50</span></p>
            <button id="start-task">টাস্ক শুরু করুন</button>
        </section>
        <section id="withdraw">
            <h2>Withdraw Section</h2>
            <p>Minimum withdraw: ০.০২$</p>
            <form id="withdraw-form">
                <select id="method">
                    <option value="bkash">বিকাশ</option>
                    <option value="nagad">নগদ</option>
                </select>
                <input type="text" id="phone" placeholder="১১-সংখ্যার ফোন নম্বর" maxlength="11">
                <button type="submit">উত্তোলন অনুরোধ করুন</button>
            </form>
            <p class="error" id="withdraw-error"></p>
        </section>
    </main>
    <nav>
        <button data-section="home" class="active">Home</button>
        <button data-section="task">Task</button>
        <button data-section="withdraw">withdraw</button>
    </nav>
    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        const user = tg.initDataUnsafe.user;
        document.getElementById('username').textContent = user ? user.username || user.first_name : 'GUEST-404';
        const profilePic = document.getElementById('profile-pic');
        if (user && user.photo_url) {
            profilePic.src = user.photo_url;
        } else {
            profilePic.src = 'https://via.placeholder.com/100'; // ডিফল্ট ছবি
        }

        let balance = parseFloat(localStorage.getItem('balance')) || 0;
        let lastDate = localStorage.getItem('lastDate');
        let taskCount = parseInt(localStorage.getItem('taskCount')) || 0;
        const today = new Date().toDateString();

        if (lastDate !== today) {
            taskCount = 0;
            localStorage.setItem('lastDate', today);
            localStorage.setItem('taskCount', taskCount);
        }

        function updateUI() {
            document.getElementById('balance').textContent = balance.toFixed(3);
            document.getElementById('remaining-tasks').textContent = 50 - taskCount;
        }
        updateUI();

        document.getElementById('start-task').addEventListener('click', () => {
            if (taskCount >= 50) {
                alert('আজকের টাস্ক সীমা শেষ হয়েছে!');
                return;
            }
            window.location.href = 'ad.html';
        });

        document.getElementById('withdraw-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const method = document.getElementById('method').value;
            const phone = document.getElementById('phone').value;
            const error = document.getElementById('withdraw-error');

            if (balance < 0.02) {
                error.textContent = 'সর্বনিম্ন ০.০২$ দরকার!';
                return;
            }
            if (!/^\d{11}$/.test(phone)) {
                error.textContent = 'ফোন নম্বর ১১ সংখ্যার হতে হবে!';
                return;
            }

            const message = `উত্তোলন অনুরোধ:\nব্যবহারকারী: ${user.username}\nপদ্ধতি: ${method.toUpperCase()}\nফোন: ${phone}\nপরিমাণ: $${balance.toFixed(3)}`;
            
            // এখানে টেলিগ্রাম বট API কল করুন। bot token যোগ করুন।//
            fetch(`https://api.telegram.org/bot{8200923345:AAFWo-X6Wc5T5ql0X1eLgmXsUl-sDwDKrZw}/sendMessage?chat_id=5957632735&text=${encodeURIComponent(message)}`)
             .then(() => { balance = 0; localStorage.setItem('balance', balance); updateUI(); alert('অনুরোধ পাঠানো হয়েছে!'); })
             .catch(() => alert('ত্রুটি ঘটেছে!'));

            // অস্থায়ীভাবে:
            console.log(message); // অ্যাডমিন চ্যাটে পাঠানোর জন্য
            alert('অনুরোধ পাঠানো হয়েছে! (কনসোলে দেখুন)');
            balance = 0;
            localStorage.setItem('balance', balance);
            updateUI();
        });

        const navButtons = document.querySelectorAll('nav button');
        navButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const section = btn.dataset.section;
                document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
                document.getElementById(section).classList.add('active');
                navButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // ad.html থেকে রিডিরেক্ট হলে আপডেট চেক
        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            if (params.get('adCompleted') === 'true') {
                balance += 0.005;
                taskCount++;
                localStorage.setItem('balance', balance);
                localStorage.setItem('taskCount', taskCount);
                updateUI();
            }
        });
    </script>
</body>
</html>